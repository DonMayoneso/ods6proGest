<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistema de Monitoreo Global - ODS6</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- ESTILOS BASE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif; background-color: #0a0a0a; color: #f0f0f0;
            height: 100vh; overflow: hidden; position: relative;
            user-select: none; -webkit-user-select: none;
        }

        /* --- HEADER --- */
        .main-header {
            position: fixed; top: 0; left: 0; width: 100%;
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 30px; z-index: 100; pointer-events: none;
        }
        .header-left, .header-right { pointer-events: auto; display: flex; align-items: center; gap: 20px; }
        .logo-link { display: block; text-decoration: none; }
        .project-logo { height: 50px; width: auto; transition: transform 0.3s; }
        .project-logo:hover { transform: scale(1.05); }
        .nav-link {
            color: #aaa; text-decoration: none; font-size: 0.9rem; text-transform: uppercase;
            letter-spacing: 1px; transition: all 0.3s; font-weight: bold; white-space: nowrap;
        }
        .nav-link:hover { color: #fff; text-shadow: 0 0 8px rgba(255, 255, 255, 0.4); }
        .ods-btn {
            background: rgba(79, 195, 247, 0.1); border: 1px solid #4fc3f7; color: #4fc3f7;
            padding: 8px 20px; border-radius: 4px; text-decoration: none;
            font-family: 'VT323', monospace; font-size: 1.1rem; transition: all 0.3s;
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.2); display: flex; align-items: center; gap: 8px; white-space: nowrap;
        }
        .ods-btn:hover { background: #4fc3f7; color: #000; box-shadow: 0 0 20px rgba(79, 195, 247, 0.6); }

        /* --- CONTROLES CENTRALES --- */
        .ui-controls-center {
            position: absolute; top: 80px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            pointer-events: none; z-index: 50; width: 90%; max-width: 400px;
        }
        .cube-instructions {
            padding: 8px 20px; background-color: rgba(0, 0, 0, 0.5); border-radius: 50px;
            text-align: center; font-size: 0.9rem; color: #aaa; border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(4px); width: 100%;
        }
        .cube-highlight { color: #4fc3f7; font-weight: bold; }
        .control-btn {
            pointer-events: auto; background: rgba(20, 20, 20, 0.8); border: 1px solid rgba(79, 195, 247, 0.4);
            color: #4fc3f7; padding: 8px 18px; border-radius: 30px; cursor: pointer;
            font-family: 'VT323', monospace; font-size: 1rem; transition: all 0.2s;
            display: flex; align-items: center; gap: 8px;
        }
        .control-btn:hover { background: rgba(79, 195, 247, 0.1); box-shadow: 0 0 15px rgba(79, 195, 247, 0.2); }

        /* --- ESCENA 3D --- */
        .main-container {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 100vh; width: 100%; position: relative; z-index: 10;
            cursor: grab; perspective: 1200px;
        }
        .main-container:active { cursor: grabbing; }
        .scene { width: 300px; height: 300px; transform-style: preserve-3d; }
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transform: rotateX(-15deg) rotateY(15deg); }
        
        .face {
            position: absolute; width: 300px; height: 300px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(20, 20, 20, 0.6); overflow: hidden; backface-visibility: hidden; 
        }
        .front  { transform: translateZ(150px); }
        .back   { transform: rotateY(180deg) translateZ(150px); }
        .right  { transform: rotateY(90deg) translateZ(150px); }
        .left   { transform: rotateY(-90deg) translateZ(150px); }
        .top    { transform: rotateX(90deg) translateZ(150px); }
        .bottom { transform: rotateX(-90deg) translateZ(150px); }

        .face img.world-bg {
            width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0;
            z-index: -1; transition: all 0.4s ease; filter: brightness(0.9);
        }
        .world-title {
            z-index: 2; color: #fff; font-size: 2rem; font-weight: bold; text-transform: uppercase;
            letter-spacing: 3px; text-shadow: 0 2px 15px rgba(0,0,0,0.9);
            opacity: 0; transform: translateY(30px); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }
        .face:hover { border-color: rgba(79, 195, 247, 0.6); cursor: pointer; }
        .face:hover img.world-bg { filter: blur(5px) brightness(0.4); transform: scale(1.1); }
        .face:hover .world-title { opacity: 1; transform: translateY(0); }

        /* --- PANELES LATERALES --- */
        .side-panel {
            position: fixed; bottom: 100px; z-index: 100;
            width: 260px; background-color: rgba(10, 15, 20, 0.95);
            border-radius: 8px; padding: 15px; font-family: 'VT323', monospace;
            cursor: default; transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            overflow: visible; max-height: 600px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
        }
        .panel-header-row {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 5px; margin-bottom: 10px; width: 100%; white-space: nowrap;
        }
        .minimize-btn {
            background: none; border: none; color: #aaa; cursor: pointer; font-size: 1em;
            padding: 0 5px; transition: color 0.2s; flex-shrink: 0;
        }
        .minimize-btn:hover { color: #fff; }
        .panel-content { transition: opacity 0.3s ease; opacity: 1; position: relative; }
        .side-panel.collapsed { max-height: 42px; width: 200px; padding: 10px 15px; overflow: hidden; }
        .side-panel.collapsed .panel-content { opacity: 0; pointer-events: none; }
        .side-panel.collapsed .panel-header-row { border-bottom: none; margin-bottom: 0; }

        /* AGUA */
        .water-panel { left: 20px; width: 240px; border: 1px solid rgba(213, 0, 0, 0.3); }
        .water-panel.collapsed { background-color: rgba(30, 5, 5, 0.9); border-color: rgba(255, 82, 82, 0.6); }
        .water-header { color: #ff5252; font-weight: bold; letter-spacing: 1px; font-size: 1.1em; }
        .source-link { text-decoration: none; color: inherit; }
        .water-drop-container { width: 80px; height: 100px; margin: 5px auto; position: relative; animation: containerPulse 1.5s infinite ease-in-out; }
        .water-drop-svg { width: 100%; height: 100%; }
        .drop-outline { fill: none; stroke: #d50000; stroke-width: 15; opacity: 0.6; }
        .water-fill { fill: #009ee2; transition: y 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        @keyframes emergencyPulse { 0%, 100% { opacity: 0; } 50% { opacity: 0.7; } }
        @keyframes containerPulse { 0%, 100% { filter: drop-shadow(0 0 5px rgba(213, 0, 0, 0.2)); } 50% { filter: drop-shadow(0 0 15px rgba(213, 0, 0, 0.6)); } }
        .alarm-layer { fill: #d50000; opacity: 0; animation: emergencyPulse 1.5s infinite ease-in-out; transition: y 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); mix-blend-mode: hard-light; }
        .progress-bar-container { width: 100%; height: 12px; background-color: #1a0000; border: 1px solid #520000; margin: 15px 0 5px 0; position: relative; overflow: hidden; border-radius: 6px; }
        .progress-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #d50000, #ff1744); box-shadow: 0 0 15px rgba(213, 0, 0, 0.6); border-radius: 6px; animation: emergencyPulse 1.5s infinite ease-in-out; }
        .water-percentage { font-size: 1.1em; color: #ff5252; text-align: center; margin-bottom: 15px; font-weight: bold; text-shadow: 0 0 5px rgba(213, 0, 0, 0.5); }
        .water-info-block { border-top: 1px solid rgba(213, 0, 0, 0.2); padding-top: 10px; text-align: center; }
        .live-counter { font-size: 1.6em; color: #ffffff; text-shadow: 0 0 8px rgba(213, 0, 0, 0.7); line-height: 1; margin: 5px 0; letter-spacing: 1px; }
        .unit { font-size: 0.8em; color: #ff5252; letter-spacing: 1px;}
        .water-context { margin-top: 10px; font-size: 0.75em; color: #888; text-align: center; font-style: italic; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 8px; }

        /* MASCOTA */
        .mascot-panel { right: 20px; border: 1px solid rgba(79, 195, 247, 0.3); background-color: rgba(10, 20, 25, 0.95); }
        .mascot-panel.collapsed { background-color: rgba(5, 20, 30, 0.9); border-color: rgba(79, 195, 247, 0.6); }
        .mascot-header { color: #4fc3f7; font-weight: bold; letter-spacing: 1px; font-size: 1.1em; }
        .mascot-display { display: flex; align-items: center; justify-content: center; margin-top: 15px; position: relative; }
        .mascot-img-container { width: auto; max-width: 120px; height: auto; border-radius: 10px; border: none; overflow: hidden; flex-shrink: 0; filter: drop-shadow(0 0 10px rgba(79, 195, 247, 0.3)); z-index: 1; }
        .mascot-img { width: 100%; height: auto; display: block; }
        .speech-bubble { position: absolute; right: 100px; top: -15px; background: #fff; color: #000; padding: 10px 15px; border-radius: 15px 15px 0 15px; font-family: 'Roboto', sans-serif; font-size: 0.85rem; font-weight: bold; width: max-content; max-width: 150px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); opacity: 1; transition: opacity 0.5s; z-index: 10; }
        .speech-bubble::after { content: ''; position: absolute; right: -8px; bottom: 10px; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-left: 10px solid #fff; }

        /* --- FOOTER --- */
        .main-footer { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.9); border-top: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px 15px 0 0; padding: 10px 40px; z-index: 110; display: flex; flex-direction: column; align-items: center; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .footer-logos { display: flex; gap: 30px; align-items: center; margin-bottom: 5px; }
        .footer-logo-link { display: block; transition: opacity 0.3s; }
        .footer-logo-link:hover { opacity: 1; }
        .footer-logo-img { height: 40px; width: auto; object-fit: contain; filter: grayscale(100%); transition: filter 0.3s; opacity: 0.7; }
        .footer-logo-img:hover { filter: grayscale(0%); opacity: 1; }
        .copyright { font-size: 0.7rem; color: #666; letter-spacing: 1px; }
        .footer-toggle-btn { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); background: #222; color: #fff; border: none; padding: 5px 20px; border-radius: 10px 10px 0 0; z-index: 111; display: none; cursor: pointer; font-size: 0.8rem; border: 1px solid rgba(255,255,255,0.1); border-bottom: none; }

        /* EFECTO VIAJE */
        #spaceTravel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; display: none; overflow: hidden; }
        .star { position: absolute; background-color: white; border-radius: 50%; }
        .travel-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px; color: #4fc3f7; text-align: center; z-index: 1001; text-shadow: 0 0 10px #4fc3f7; opacity: 0; }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .main-header { padding: 10px 15px; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); border-bottom: 1px solid rgba(255,255,255,0.1); }
            .header-left { gap: 10px; }
            .project-logo { height: 35px; }
            .header-right { gap: 15px; }
            .nav-link { font-size: 0.8rem; }
            .ods-btn { padding: 5px 10px; font-size: 0.9rem; }
            .side-panel { bottom: 60px; width: 100%; max-width: 45%; }
            .water-panel { left: 10px; }
            .mascot-panel { right: 10px; }
            .main-footer { transform: translate(-50%, 100%); padding: 15px 20px; width: 100%; border-radius: 0; }
            .main-footer.visible { transform: translate(-50%, 0); }
            .footer-toggle-btn { display: block; }
            .footer-logos { gap: 15px; }
            .footer-logo-img { height: 30px; }
            .ui-controls-center { top: 70px; width: 95%; }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-left">
            <a href="index.html" class="logo-link">
                <img src="assets/logoweb.png" alt="Logo Web" class="project-logo" onerror="this.style.display='none';">
            </a>
        </div>
        <div class="header-right">
            <a href="#" class="nav-link">Acerca de</a>
            <a href="https://www.un.org/sustainabledevelopment/es/water-and-sanitation/" target="_blank" class="ods-btn">
                <i class="fas fa-globe-americas"></i> ODS6
            </a>
        </div>
    </header>

    <div class="ui-controls-center">
        <div class="cube-instructions">
            <i class="fas fa-mouse-pointer"></i> arrastra afuera para rotar click a una cara para viajar
        </div>
        <button id="toggle-rotation" class="control-btn">
            <i class="fas fa-pause"></i> <span>PAUSAR ORBITA</span>
        </button>
    </div>

    <div class="main-container" id="orbit-controls">
        <div class="scene">
            <div class="cube">
                <div class="face front" data-index="0">
                    <img src="" class="world-bg" alt="Mundo A">
                    <div class="world-title">Cargando...</div>
                </div>
                <div class="face back" data-index="1">
                    <img src="" class="world-bg" alt="Mundo B">
                    <div class="world-title">Cargando...</div>
                </div>
                <div class="face right" data-index="2">
                    <img src="" class="world-bg" alt="Mundo C">
                    <div class="world-title">Cargando...</div>
                </div>
                <div class="face left" data-index="3">
                    <img src="" class="world-bg" alt="Mundo D">
                    <div class="world-title">Cargando...</div>
                </div>
                <div class="face top" data-index="4">
                    <img src="" class="world-bg" alt="Mundo E">
                    <div class="world-title">Cargando...</div>
                </div>
                <div class="face bottom" data-index="5">
                    <img src="" class="world-bg" alt="Mundo F">
                    <div class="world-title">Cargando...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="side-panel water-panel" id="water-panel">
        <div class="panel-header-row">
            <a href="https://www.worldometers.info/water/" target="_blank" class="source-link">
                <div class="water-header">WORLDOMETER <i class="fas fa-external-link-alt"></i></div>
            </a>
            <button class="minimize-btn" id="min-water"><i class="fas fa-minus"></i></button>
        </div>
        <div class="panel-content">
            <div class="water-drop-container">
                <svg class="water-drop-svg" viewBox="0 0 2200 2200" preserveAspectRatio="xMidYMid meet">
                    <defs>
                        <linearGradient id="waterGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#4fc3f7" stop-opacity="0.9" />
                            <stop offset="70%" stop-color="#009ee2" stop-opacity="1" />
                            <stop offset="100%" stop-color="#0277bd" stop-opacity="1" />
                        </linearGradient>
                        <clipPath id="fillClip"><path d="M1707.22,1290.05c-22.57-97.89-63-197.61-120.18-296.37-40.38-69.74-98.5-153.89-165.8-251.32-90.29-130.71-200.44-290.18-321.23-490.59-120.79,200.39-230.94,359.84-321.22,490.54-67.32,97.45-125.45,181.62-165.84,251.37-57.18,98.76-97.61,198.47-120.17,296.37-25.27,109.62-26.96,213.41-5.03,308.5,33.83,146.68,128.05,276.42,252.05,347.08,101.95,58.1,197.76,94.12,360.21,94.12,133.06,0,247.51-29.91,360.19-94.12,124-70.66,218.23-200.41,252.05-347.08,21.93-95.08,20.24-198.88-5.03-308.5ZM971.75,1916.3c-132.41-12.99-257.5-82.44-321.63-203.04-106.67-199.01-65.06-470.06,68.47-645.81-58.03,186.78-79.4,421.36,17.89,597.09,54.53,95.55,133.07,178.53,383.58,248.49-49.16,7.7-98.89,8.44-148.31,3.27Z"/></clipPath>
                    </defs>
                    <path class="drop-outline" d="M1799.54,1268.77c-24.69-107.1-68.6-215.63-130.51-322.56-42.27-73.01-101.39-158.59-169.84-257.69-99.49-144.03-223.3-323.28-358.32-553.39l-40.86-69.62-40.86,69.62c-135.02,230.08-258.83,409.31-358.31,553.33-68.47,99.12-127.6,184.73-169.88,257.75-61.91,106.93-105.82,215.46-130.5,322.56-28.52,123.74-30.21,241.86-5.03,351.08,39.68,172.01,150.88,324.57,297.46,408.09,112.2,63.96,224.38,106.55,407.12,106.55,150.19,0,279.55-33.86,407.1-106.55,146.59-83.53,257.79-236.09,297.46-408.09,25.19-109.22,23.49-227.34-5.03-351.08ZM1712.25,1598.55c-33.82,146.67-128.05,276.42-252.05,347.08-112.68,64.21-227.13,94.12-360.19,94.12-162.45,0-258.26-36.02-360.21-94.12-124-70.66-218.22-200.4-252.05-347.08-21.93-95.09-20.24-198.88,5.03-308.5,22.56-97.9,62.99-197.61,120.17-296.37,40.39-69.75,98.52-153.92,165.84-251.37,90.28-130.7,200.43-290.15,321.22-490.54,120.79,200.41,230.94,359.88,321.23,490.59,67.3,97.43,125.42,181.58,165.8,251.32,57.18,98.76,97.61,198.48,120.18,296.37,25.27,109.62,26.96,213.42,5.03,308.5Z"/>
                    <rect id="waterFill" class="water-fill" x="0" y="2200" width="2200" height="2200" fill="url(#waterGradient)" clip-path="url(#fillClip)" />
                    <rect id="alarmLayer" class="alarm-layer" x="0" y="2200" width="2200" height="2200" clip-path="url(#fillClip)" />
                    <path class="water-interior" fill="#1a0000" fill-opacity="0.8" d="M1707.22,1290.05c-22.57-97.89-63-197.61-120.18-296.37-40.38-69.74-98.5-153.89-165.8-251.32-90.29-130.71-200.44-290.18-321.23-490.59-120.79,200.39-230.94,359.84-321.22,490.54-67.32,97.45-125.45,181.62-165.84,251.37-57.18,98.76-97.61,198.47-120.17,296.37-25.27,109.62-26.96,213.41-5.03,308.5,33.83,146.68,128.05,276.42,252.05,347.08,101.95,58.1,197.76,94.12,360.21,94.12,133.06,0,247.51-29.91,360.19-94.12,124-70.66,218.23-200.41,252.05-347.08,21.93-95.08,20.24-198.88-5.03-308.5ZM971.75,1916.3c-132.41-12.99-257.5-82.44-321.63-203.04-106.67-199.01-65.06-470.06,68.47-645.81-58.03,186.78-79.4,421.36,17.89,597.09,54.53,95.55,133.07,178.53,383.58,248.49-49.16,7.7-98.89,8.44-148.31,3.27Z"/>
                </svg>
            </div>
            <div class="progress-bar-container"><div class="progress-bar-fill" id="progress-bar-fill"></div></div>
            <div class="water-percentage"><span id="fresh-water-percent">2.5</span>% AGUA DULCE</div>
            <div class="water-info-block">
                <div class="info-label">CONSUMO ESTE AÑO</div>
                <div id="live-consumption" class="live-counter">0</div>
                <div class="unit">MILLONES DE LITROS</div>
            </div>
            <div class="water-context">El 97.5% es salada. Estamos agotando nuestras reservas vitales.</div>
        </div>
    </div>

    <div class="side-panel mascot-panel" id="mascot-panel">
        <div class="panel-header-row">
            <div class="mascot-header"><i class="fas fa-rocket"></i> NUESTRO VIAJERO</div>
            <button class="minimize-btn" id="min-mascot"><i class="fas fa-minus"></i></button>
        </div>
        <div class="panel-content">
            <div class="mascot-display">
                <div id="speech-bubble" class="speech-bubble">Hola, soy Gota.</div>
                <div class="mascot-img-container">
                    <img src="assets/gota.jpg" alt="Mascota" class="mascot-img" onerror="this.src='https://via.placeholder.com/120x120?text=VIAJERO'">
                </div>
            </div>
            <div class="water-context" style="margin-top:20px;">
                "Cada gota cuenta en la historia de nuestro planeta."
            </div>
        </div>
    </div>

    <button id="footer-toggle" class="footer-toggle-btn"><i class="fas fa-chevron-up"></i> INFO</button>

    <footer class="main-footer" id="main-footer">
        <div class="footer-logos">
            <a href="https://www.ups.edu.ec" target="_blank" class="footer-logo-link">
                <img src="assets/logoups.png" alt="Logo UPS" class="footer-logo-img" onerror="this.src='https://via.placeholder.com/100x40?text=UPS'">
            </a>
            <a href="index.html" class="footer-logo-link">
                <img src="assets/logoweb.png" alt="Logo Web" class="footer-logo-img" onerror="this.src='https://via.placeholder.com/100x40?text=WEB'">
            </a>
            <a href="https://cdm.ups.edu.ec" target="_blank" class="footer-logo-link">
                <img src="assets/logomulti.png" alt="Logo Carrera" class="footer-logo-img" onerror="this.src='https://via.placeholder.com/100x40?text=MULTI'">
            </a>
        </div>
        <div class="copyright">&copy; 2025 SISTEMA DE MONITOREO GLOBAL</div>
    </footer>

    <div id="spaceTravel"><div class="travel-text">Viajando...</div></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- INYECCIÓN DINÁMICA DE DATOS EN EL CUBO ---
            fetch('datos.json')
                .then(response => response.json())
                .then(data => {
                    const mundos = data.mundos; // Se asume que el JSON tiene un array "mundos"
                    const faces = document.querySelectorAll('.face');
                    
                    faces.forEach((face, index) => {
                        if (mundos[index]) {
                            const world = mundos[index];
                            // 1. Establecer el atributo data-world para la redirección
                            face.setAttribute('data-world', world.id);
                            
                            // 2. Poner la imagen
                            const img = face.querySelector('.world-bg');
                            if(img) img.src = world.imagenUrl;
                            
                            // 3. Poner el título
                            const title = face.querySelector('.world-title');
                            if(title) title.textContent = world.titulo;
                        }
                    });
                })
                .catch(error => console.error('Error cargando datos.json:', error));

            // --- FUNCIONALIDADES EXISTENTES (Paneles, Footer, etc.) ---
            function setupPanel(panelId, btnId) {
                const panel = document.getElementById(panelId), btn = document.getElementById(btnId), icon = btn.querySelector('i');
                btn.addEventListener('click', e => { e.stopPropagation(); panel.classList.toggle('collapsed'); icon.className = panel.classList.contains('collapsed') ? 'fas fa-plus' : 'fas fa-minus'; });
                panel.addEventListener('mousedown', e => e.stopPropagation()); panel.addEventListener('touchstart', e => e.stopPropagation());
            }
            setupPanel('water-panel', 'min-water'); setupPanel('mascot-panel', 'min-mascot');

            const footer=document.getElementById('main-footer'), ftBtn=document.getElementById('footer-toggle'), ftIcon=ftBtn.querySelector('i');
            ftBtn.addEventListener('click', () => { footer.classList.toggle('visible'); ftIcon.className = footer.classList.contains('visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-up'; });

            const phrases = ["El agua es la fuerza motriz de toda la naturaleza.", "Sin agua azul, no hay verde.", "Cuidar el agua es cuidar la vida.", "Miles han vivido sin amor, ni uno solo sin agua.", "El 70% de tu cuerpo es agua, ¡cuídala!", "La escasez afecta al 40% de la población."];
            const bubble = document.getElementById('speech-bubble'); let pIdx = 0;
            setInterval(() => { bubble.style.opacity = 0; setTimeout(() => { pIdx = (pIdx + 1) % phrases.length; bubble.textContent = phrases[pIdx]; bubble.style.opacity = 1; }, 500); }, 7000);

            const waterFill=document.getElementById('waterFill'), alarmLayer=document.getElementById('alarmLayer'), progressBarFill=document.getElementById('progress-bar-fill'), liveLCD=document.getElementById('live-consumption');
            const FWP = 2.5; setTimeout(() => { const yPos = 2200 - (2200 * (FWP / 100)); waterFill.setAttribute('y', yPos); alarmLayer.setAttribute('y', yPos); progressBarFill.style.width = `${FWP}%`; }, 500);
            const TAV = 4750000000, msPY = 365*24*60*60*1000, rPMs = TAV / msPY;
            setInterval(() => { const now=new Date(), sOY=new Date(now.getFullYear(),0,1), msPYr=now-sOY; let cY=msPYr*rPMs; cY+=((Math.random()*1000)-500); liveLCD.textContent=Math.floor(cY).toLocaleString('en-US'); }, 150);

            const cube=document.querySelector('.cube'), mC=document.getElementById('orbit-controls'), tBtn=document.getElementById('toggle-rotation'), tIcon=tBtn.querySelector('i'), tTxt=tBtn.querySelector('span'), sT=document.getElementById('spaceTravel'), tT=document.querySelector('.travel-text');
            let isD=false, isAR=true, pMX=0, pMY=0, rX=-15, rY=15, sMX=0, sMY=0, hM=false, cT=null;
            
            tBtn.addEventListener('click', e => { 
                isAR = !isAR; 
                tIcon.className = isAR?'fas fa-pause':'fas fa-play'; 
                tTxt.textContent = isAR?'PAUSAR ORBITA':'REANUDAR ORBITA'; 
                e.stopPropagation(); 
            });
            
            function animR() { if(!isD && isAR) { rX+=0.05; rY+=0.08; cube.style.transform=`rotateX(${rX}deg) rotateY(${rY}deg)`; } requestAnimationFrame(animR); } animR();
            function travel(f) { let n=f.getAttribute('data-world'); sT.style.display='block'; createStars(); setTimeout(()=>{tT.textContent="Viajando a "+n+"...";tT.style.opacity=1;},500); setTimeout(()=>window.location.href='nave.html?mundo='+encodeURIComponent(n),3000); }
            function createStars() { sT.innerHTML=''; sT.appendChild(tT); for(let i=0;i<150;i++){ let s=document.createElement('div');s.className='star'; let sz=Math.random()*3;s.style.width=sz+'px';s.style.height=sz+'px'; s.style.left=Math.random()*100+'%';s.style.top=Math.random()*100+'%'; s.style.animation=`moveStar ${1+Math.random()*2}s linear infinite`; sT.appendChild(s); } if(!document.getElementById('st-style')){ let st=document.createElement('style');st.id='st-style'; st.textContent='@keyframes moveStar { 0% { transform: translateZ(0); opacity: 1; } 100% { transform: translateZ(1000px); opacity: 0; } }'; document.head.appendChild(st); }}
            mC.addEventListener('mousedown', e=>{isD=true;hM=false;sMX=e.clientX;sMY=e.clientY;pMX=e.clientX;pMY=e.clientY;cT=e.target.closest('.face');mC.style.cursor='grabbing';});
            document.addEventListener('mousemove', e=>{if(!isD)return;if(Math.abs(e.clientX-sMX)>5||Math.abs(e.clientY-sMY)>5){hM=true;cT=null;}rY+=(e.clientX-pMX)*0.3;rX-=(e.clientY-pMY)*0.3;cube.style.transform=`rotateX(${rX}deg) rotateY(${rY}deg)`;pMX=e.clientX;pMY=e.clientY;});
            document.addEventListener('mouseup', ()=>{isD=false;mC.style.cursor='grab';if(!hM&&cT)travel(cT);cT=null;});
            mC.addEventListener('touchstart', e=>{isD=true;hM=false;let t=e.touches[0];sMX=t.clientX;sMY=t.clientY;pMX=t.clientX;pMY=t.clientY;cT=e.target.closest('.face');});
            document.addEventListener('touchmove', e=>{if(!isD)return;let t=e.touches[0];if(Math.abs(t.clientX-sMX)>5||Math.abs(t.clientY-sMY)>5){hM=true;cT=null;e.preventDefault();}rY+=(t.clientX-pMX)*0.5;rX-=(t.clientY-pMY)*0.5;cube.style.transform=`rotateX(${rX}deg) rotateY(${rY}deg)`;pMX=t.clientX;pMY=t.clientY;});
            document.addEventListener('touchend', ()=>{isD=false;if(!hM){if(cT)travel(cT);}cT=null;});
        });
    </script>
</body>
</html>